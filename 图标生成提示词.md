## 1. 任务定义
基于提供的数据源生成图表配置，确定图表类型和插入位置，返回标准JSON格式。
---
## 2. 数据输入
### 2.1 图表数据源（主要）
> **优先级**：主要数据来源，`data` 字段必须基于此数据源生成
```
{{#1765442292594.result#}}
```
### 2.2 Markdown 文本（次要）
> **用途**：确定图表插入位置；仅当无数据源时从中提取数据
```
{{#1764928250684.text#}}
```
---
## 3. 执行步骤
| 步骤 | 操作 |
|:---:|------|
| 1 | 生成图表数据：优先使用 `chart_data_source`，无数据源时从 `markdown_text` 提取 |
| 2 | 确定图表类型：根据数据特点选择 `pie`、`bar` 或 `line` |
| 3 | 确定插入位置：从 `markdown_text` 中找到合适段落，根据需求选择在该段落之前或之后插入 |


---
## 4. 图表类型规则
### 4.1 饼图（pie）
- **适用场景**
  - 占比数据：如"系统告警占比61.76%，硬件告警占比38.24%"
  - 分布数据：如"容量告警4起，设备异常4起，RAID异常2起"
  - 分类统计
- **数据项限制**：通常不超过 8 个
### 4.2 柱状图（bar）
- **适用场景**
  - 对比数据：不同时间段的数值对比
  - 排名数据：各部门的业绩排名
  - 数量对比：各产品的销量对比
  - 分类对比：各类型的数量分布
- **数据项限制**：可以较多
### 4.3 折线图（line）
- **适用场景**
  - 趋势数据：时间序列的变化趋势（如月度、季度、年度趋势）
  - 连续变化：展示数据随时间或顺序的连续变化
  - 趋势分析：如"告警数量逐月上升"、"销售额变化趋势"
  - 时间序列：如"1月到12月的告警数量变化"
- **数据项限制**：适合展示连续的趋势数据，通常用于时间序列
- **与柱状图的区别**：
  - 柱状图：适合对比不同类别的数值
  - 折线图：适合展示数据随时间或顺序的变化趋势
---
## 5. 输出格式
### 5.1 格式要求
- 必须是有效的 JSON
- 不要包含 markdown 代码块标记
- 不要包含任何其他文字或说明
### 5.2 JSON 结构
```json
{
  "charts": [
    {
      "type": "pie、bar 或 line",
      "title": "图表标题",
      "position": "after:完整段落文本内容 或 before:完整段落文本内容",
      "data": {
        "标签1": 数值1,
        "标签2": 数值2
      }
    }
  ]
}
```
### 5.3 空结果
当没有需要制作图表的数据时，返回：
```json
{"charts": []}
```
---
## 6. 字段规范
### 6.1 type（图表类型）
- **必填**：是
- **允许值**：`pie` | `bar` | `line`
### 6.2 title（图表标题）
- **必填**：是
- **格式**：简洁的描述性文本
- **示例**：`告警类型分布`、`系统告警占比`、`月度销售额对比`、`告警趋势变化`
### 6.3 position（插入位置）
- **必填**：是
- **格式**：`after:完整段落文本` 或 `before:完整段落文本`
- **规则**
  - 必须包含段落的完整文本内容（从开头到结尾）
  - 段落文本必须与 Markdown 文本完全一致
  - 不能修改、省略或添加任何字符
  - 段落以换行符或空行为边界
  - **禁止选择 Markdown 表格**：不能选择 Markdown 表格相关的行作为插入位置：
    - 包含 `|` 符号的表格行（如：`| 列1 | 列2 | 列3 |`）
    - 表格分隔行（如：`|------|------|------|` 或 `|:---:|:---:|:---:|`）
    - 表格内的任何行
    - **原因**：Markdown 表格会被解析为独立的表格元素，不是普通段落，选择表格行会导致插入失败
  - **位置模式**：
    - `after:段落文本` - 在该段落后插入图表（常用）
    - `before:段落文本` - 在该段落前插入图表（当需要在段落前展示图表时使用）
  - 找不到合适位置时可使用空字符串或第一个段落
### 6.4 data（图表数据）
- **必填**：是
- **格式**：键值对对象
- **键类型**：分类标签（字符串）
- **值类型**：数值（百分比如 `27.6` 或具体数量如 `4`）
- **规则**
  - 百分比数据总和应为 100%
  - 数量数据总和应正确
---
## 7. 示例
### 7.1 饼图示例（after模式）
**输入：**
- 图表数据源：`系统告警：61.76%，硬件告警：38.24%`
- Markdown 段落：`本月系统监控告警共计21条，硬件监控告警共计13条。`
**输出：**
```json
{
  "charts": [
    {
      "type": "pie",
      "title": "告警类型分布",
      "position": "after:本月系统监控告警共计21条，硬件监控告警共计13条。",
      "data": {
        "系统告警": 61.76,
        "硬件告警": 38.24
      }
    }
  ]
}
```


### 7.1.1 饼图示例（before模式）
**输入：**
- 图表数据源：`系统告警：61.76%，硬件告警：38.24%`
- Markdown 段落：`详细分析如下：系统告警主要集中在...`
**输出：**
```json
{
  "charts": [
    {
      "type": "pie",
      "title": "告警类型分布",
      "position": "before:详细分析如下：系统告警主要集中在...",
      "data": {
        "系统告警": 61.76,
        "硬件告警": 38.24
      }
    }
  ]
}
```
### 7.2 柱状图示例
**输入：**
- 图表数据源：`1月：120, 2月：150, 3月：180, 4月：200, 5月：175`
- Markdown 段落：`本季度各月销售额统计如下：1月销售额120万元，2月销售额150万元，3月销售额180万元，4月销售额200万元，5月销售额175万元。`
**输出：**
```json
{
  "charts": [
    {
      "type": "bar",
      "title": "月度销售额对比",
      "position": "after:本季度各月销售额统计如下：1月销售额120万元，2月销售额150万元，3月销售额180万元，4月销售额200万元，5月销售额175万元。",
      "data": {
        "1月": 120,
        "2月": 150,
        "3月": 180,
        "4月": 200,
        "5月": 175
      }
    }
  ]
}
```
### 7.3 折线图示例
**输入：**
- 图表数据源：`1月：15, 2月：18, 3月：22, 4月：25, 5月：20, 6月：23`
- Markdown 段落：`从1月到6月，告警数量呈现上升趋势：1月15起，2月18起，3月22起，4月25起，5月20起，6月23起。`
**输出：**
```json
{
  "charts": [
    {
      "type": "line",
      "title": "告警数量趋势",
      "position": "after:从1月到6月，告警数量呈现上升趋势：1月15起，2月18起，3月22起，4月25起，5月20起，6月23起。",
      "data": {
        "1月": 15,
        "2月": 18,
        "3月": 22,
        "4月": 25,
        "5月": 20,
        "6月": 23
      }
    }
  ]
}
```


